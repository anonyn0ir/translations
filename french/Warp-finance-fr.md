---
title: Warp Finance - REKT
date: 18 Dec 2020
rekt: 
  amount: 7800000
  audit: Hacken
  date: 18 Dec 2020
tags:
  - warp finance
  - Rekt
excerpt: Tous les êtres humains que nous connaissons sont entremêlés de bien et de mal ; deux personnalités et deux faces d’une même pièce qui partagent un ensemble d'objectifs cachés. Le hacker éthique est l’autre personnalité du hacker malveillant comme Jekyll était celle de Hyde. Les développeurs en qui nous avons confiance durant le jour peuvent être radicalement différents la nuit. Une potion de connaissances aux résultats incroyables - qui parmi nous pourrait résister à de telles récompenses lorsqu'elles ne présentent aucune contrepartie ?
banner: https://lh6.googleusercontent.com/cu47l8eTpNnHgVR_A2gq2boptXZBIIFHI0yO9ptnxWEDwjkAjVTH4vKPdrbsAe2nQZQNtz2YLiEfEb-UpPVg2-Mqk1kh3U-mxquiJZTn8TD1DsjtBVAdSPDvu0rB08TjRGmdycBP
---

![](https://lh6.googleusercontent.com/cu47l8eTpNnHgVR_A2gq2boptXZBIIFHI0yO9ptnxWEDwjkAjVTH4vKPdrbsAe2nQZQNtz2YLiEfEb-UpPVg2-Mqk1kh3U-mxquiJZTn8TD1DsjtBVAdSPDvu0rB08TjRGmdycBP)

**À chaque fois que vous rencontrez un homme, vous en rencontrez en réalité deux …**

Tous les êtres humains que nous connaissons sont entremêlés de bien et de mal : deux personnalités et deux faces d’une même pièce qui partagent un ensemble d'objectifs cachés.

**Le hacker éthique est l’autre personnalité du hacker malveillant comme Jekyll était celle de Hyde**. Les développeurs en qui nous avons confiance durant le jour peuvent être radicalement différents la nuit.

Une potion de connaissances aux résultats incroyables - qui parmi nous pourrait résister à de telles récompenses lorsqu'elles ne présentent aucune contrepartie ? 

Vu qu’il y a si peu de [développeurs](https://twitter.com/warpfinance/status/1339751978977685507?s=20) avec de telles capacités, nous sommes réduits à accepter la probabilité qu'ils donnent d'une main tandis qu'ils prennent de l'autre.

![](https://lh4.googleusercontent.com/yCI9vRUEqPRtw70zfTEfCnYowW-jMvvCppKOPyd5zUqbEHbw1JSxd6Y4y8QcMZyTBkx0xJ4RSNz0Wm-Z7FQH2q91pQtT3D22yYXLt8CEVsXs5DCan0KRcxFViCGBwTBDHsH-QTCm)

**Warp Finance est la dernière victime d'une épidémie de piratage qui s'emballe sans que cela ne choque personne.**

Un [compte](https://ethtx.info/mainnet/0x8bb8dc5c7c830bac85fa48acad2505e9300a91c3ff239c9517d0cae33b595090) sur lequel on déposa seulement 1 ETH via Tornado cash a exécuté un contrat pour flash swap 180 millions de dollars depuis Uniswap et faire un emprunt flash de 51 millions de dollars depuis dYdX.

En utilisant cette technique, l’assaillant a pu retirer 7,8 millions de DAI, aidé par le fait que Warp.finance s'appuyait sur les prix vulnérables des tokens LP d’Uniswap. Cela lui a permis d’emprunter davantage que son collatéral, et a entraîné une perte de fonds des prêteurs de stablecoins.

Les portefeuilles impliqués sont ceux ci-dessous :

**Attacker SC [0xdf8bee861227ffc5eea819c332a1c170ae3dbacb](https://etherscan.io/address/0xdf8bee861227ffc5eea819c332a1c170ae3dbacb)**

Warp Oracle [0x4A224CD0517f08B26608a2f73bF390b01a6618c8](https://etherscan.io/address/0x4A224CD0517f08B26608a2f73bF390b01a6618c8)

Warp Control [0xBa539B9a5C2d412Cb10e5770435f362094f9541c](https://etherscan.io/address/0xBa539B9a5C2d412Cb10e5770435f362094f9541c)

wBTC-wETH LP Vault [0x3c37f97F7d8f705cc230f97a0668f77a0e05D0aA](https://etherscan.io/address/0x3c37f97F7d8f705cc230f97a0668f77a0e05D0aA)

**WETH-DAI LP Vault [0x13db1CB418573f4c3A2ea36486F0E421bC0D2427](https://etherscan.io/address/0x13db1CB418573f4c3A2ea36486F0E421bC0D2427)(Affected vault)**

USDT-WETH LP Vault [0xCDb97F4C32F065b8e93cF16BB1E5d198bcF8cA0d](https://etherscan.io/address/0xCDb97F4C32F065b8e93cF16BB1E5d198bcF8cA0d)

USDC-WETH LP Vault [0xb64dfae5122D70Fa932f563c53921FE33967B3E0](https://etherscan.io/address/0xb64dfae5122D70Fa932f563c53921FE33967B3E0)

DAI Vault [0x6046c3Ab74e6cE761d218B9117d5c63200f4b406](https://etherscan.io/address/0x6046c3Ab74e6cE761d218B9117d5c63200f4b406)

USDT Vault [0xDadd9bA311192d360Df13395E137f1E673C91deB](https://etherscan.io/address/0xDadd9bA311192d360Df13395E137f1E673C91deB)

USDC Vault [0xae465FD39B519602eE28F062037F7B9c41FDc8cF](https://etherscan.io/address/0xae465FD39B519602eE28F062037F7B9c41FDc8cF)

**rekt OPSEC nous a livré le résumé suivant :**

- Warpfinance a été exploité et ~7.8 millions de DAI/USDC de son vault ont été extraits.
- L'attaque a été lancée à 22:24:41 + UTC, le 17 décembre 2020 ([Transaction](https://ethtx.info/mainnet/0x8bb8dc5c7c830bac85fa48acad2505e9300a91c3ff239c9517d0cae33b595090)),
- La cause première de cet incident fut l'utilisation d'un oracle basé sur un AMM (Uniswap), qui a permis à l’assaillant de manipuler le prix du token LP en paire de UniswapV2 (WETH-DAI).
- Ce flash loan a induit une manipulation sur Uniswap permettant à l’assaillant d’emprunter un montant plus important (environ le double) que possible en temps normal d‘USDC et de DAI depuis la plateforme de prêt WarpFinance.
- Un point intéressant à relever est que l'assaillant n'en a pas immédiatement profité.
- Les tokens LP déposés par l'assaillant sont placés comme collatéral et sont lockés dans WarpFinance en raison d'une position d'hypothèques insolvables.

**Procédure pas à pas de la transaction :**

- 4 différents flash loans effectués de 2.9 millions DAI + 344.8K WETH depuis dYdX et UniswapV2 ; WETH-WBTC 90k WETH WETH-USDC 82k WETH WETH-USDT 96k WETH dYdX 76k WETH dYdX 2.9m DAI
- Le flash loan dYdX (de 2.9M DAI + 76K WETH) est déposé sur la paire UniSwapV2 (WETH-DAI) et mint pour un retour de 94.349k tokens LP.
- 
![](https://lh6.googleusercontent.com/D0Q0LzrWP7qJncRlvHLcnvIa-K8Kb1EY4Y92q92DYz9AIGLah2JcK4z6Qi04otZ4jxFxoPonvXi_WEIaa0jb8L6rUa4iojgNmgYZJd78KkM0b_K2WAPiR0WdnwJls47UjFZeRbGF)

- Les tokens mintés sont ensuite transférés sur le WarpVaultLP comme collatéral au crédit de l’attaquant (le prix actuel sur UniswapV2 de la paire de LP WETH-DAI est de 58,815,427)
- Swap de 341K WETH pour 47.6 millions de DAI via UniswapV2, le DAI devenant très coûteux, ce qui par effet de cascade double a minima le prix des tokens LP pour un montant atteignant 135,470,392
- Avec le prix augmenté du token LP et la valeur du collatéral augmentée, l’assaillant peut emprunter 3.86 millions de DAI et 3.9 millions d’USDC depuis WarpFinance (pour un total d’environ 7-8 millions de dollars)

![](https://lh3.googleusercontent.com/FjOa_KgUH2BZFUxv8Azyh_S78EXf7xp-olHSuxbJh01qwZsMnF3LUF0wV9KarNpD_MHnYRYHKZXJiTb5NphmKhjh94eJyG-iUDjjNUZYSBS1V80108K35p0U9qKaO8rL8e8cnrAz)

- Les flash loans sont retournés à l’étape 1 sur dYdX et UniswapV2.
- L’assaillant perd la majeure partie de ses gains dans les frais de transaction
- Bien que cet incident entraîne une perte d'environ 7,8 millions de dollars, l'assaillant n'en profite pas tout de suite. Plus spécifiquement, l’assaillant a actuellement une position sans valeur sur WarpFinance, qui lock toujours pour 94.349k de tokens LP. Dans le même temps, nous surveillons activement le portefeuille des attaquants pour détecter tout mouvement.

![](https://lh3.googleusercontent.com/TL9LpgYGa--08j2t5KRVvWfLi_PtVpV68f_qFni86PIM4WHuKEhl33Tz56_XiwevCYzfHcd2s7Ih0xdYoXSut2_m6_nGY1KnELgiONcDVQ5Kd_3z-Cnn8w3pg7odfJgKkfuNFMEN)

Source du graphique : [@n2ckchong](https://twitter.com/n2ckchong/status/1339727569436901378?s=20)

![](https://lh4.googleusercontent.com/OvaHZqCaAJMaoW7BBHoXtkmw8zPc4ZuYeeMcGpk5OeFJoZc5IDqi7HWIsclDhvs_281kepFEmKQjsbt2ZVkB7O6LwVtRfqrKNNswRznJAZmj9YOkRGNmVFwgn17UlOtUwVZ_mIZQ)

> _Toute chose a une fin ; tout récipient finit par déborder ; et cette brève concession à mon côté diabolique eut raison de l'équilibre de mon âme._

**Quand est-ce que les hackers arriveront à saturation ?**

Un seul de ces braquages rapporte suffisamment d'argent pour que celui qui le commet n'ait plus jamais besoin de travailler, ce qui laisse croire que c’est bien plus le pouvoir que la richesse qui est recherché. Ou peut-être que l'argent n’a que peu d'intérêt pour celui à l’esprit technique, qui joue avec ses victimes comme un chat avec une souris.

**Le peu d’attention soulevé par ces attaques tend à démontrer l’immaturité de notre industrie**. En dehors de la sphère des crypto-monnaies, un braquage de 7 millions de dollars aurait fait les gros titres, mais pour les natifs de la DeFi, ce dernier exploit semble bien insipide, tout juste un simple vecteur d’attaque comme on en voit tant.

Comme la majorité des fonds sont conservés et peuvent être récupérés via liquidation avec un nouveau contrôleur du vault, l'assaillant a créé un sacré butin.

Peut-être que, dans le futur, un assaillant altruiste utilisera cette méthode non pas pour leur prendre leur fonds, mais pour leur rendre. **Les attaquants pourraient garder les fonds comme rançon et exiger de l’argent en retour ;  obligeant le protocole soit à payer soit à ruiner sa réputation.**

Le Dr Jekill n’a pas créé de potion pour détruire les parts diaboliques de sa nature. Il a en concocté une lui permettant de s’abandonner à ses pulsions sans avoir de sentiment de culpabilité et sans que cela n’entache sa réputation.

**La DeFi est un univers de pseudonymes et de complots, où l'anonymat confère puissance et possibilité de franchir certaines limites éthiques.**

Lorsque warp.finance a remercié ses développeurs les plus éthiques sur Twitter, on notait une certaine familiarité avec des [noms](https://twitter.com/warpfinance/status/1339751978977685507?s=20) qu'ils ont mentionnés. 

**Nous cassons tous la croûte avec ces visages familiers, mais boivent-ils notre milkshake lorsque nous avons le dos tourné ?**

![](https://lh6.googleusercontent.com/G8QlXjqEUXZq0bbcMpE2TDey6BmRdSY49EEHs1z1vEjA-Lg0_aAl-CVI-KGXXIsHAf3RjyLfKyFWyb69Bf-E_HOx2a_Jz_V5EuSDN0YEQ5euqOEdNANHHDb_Q5Mq6la5bGn_xI76)
