---
title: Coinbase и оракул
date: 26 ноября 2020
tags:
  - coinbase
  - оракул
  - ликвидация
excerpt: В ходе недавних атак мы видели, как хакеры возвращали миллионы долларов своим жертвам. Или просто оставляли деньги на столе, когда могли бы унести намного больше. В процессе эпидемии хакерских атак для кражи фондов использовались многие методы, но один из персонажей сыграл сквозную роль...
banner: https://raw.githubusercontent.com/RektHQ/Assets/main/images/2020/11/MV5BMjQ1NDAwMzI4Nl5BMl5BanBnXkFtZTgwMDkwMTEyMjI@._V1_.jpg
---

![](https://raw.githubusercontent.com/RektHQ/Assets/main/images/2020/11/MV5BMjQ1NDAwMzI4Nl5BMl5BanBnXkFtZTgwMDkwMTEyMjI@._V1_.jpg)

**Мы не можем предвидеть последствия выбора, который нам непонятен.**

Мы видели, как хакеры возвращали миллионы долларов своим жертвам в ходе недавних атак. Или просто оставляли деньги на столе, когда могли бы унести намного больше.

В процессе [эпидемии хакерских атак](/hack-epidemic/) для кражи фондов использовались многие методы, но один из персонажей сыграл сквозную роль...

По словам Морфеуса, Оракул (Пифия) была на службе у сопротивления «с самого начала». Она - разумная программа, которая помогает армии сопротивления людей в освобождении человечества от гнета Машин.

В последнее время Оракул находится под постоянной атакой анонимных агентов, цель которых - манипулировать ее восприятием реальности, чтобы получить максимум прибыли.

![](https://lh4.googleusercontent.com/nhT68w2sqe78xupagMe6jDYDzLskFBs0GOd2etbcsldnFj0LNkNHCvMRApiO8qLy91wYNoO96OsN4oupin4YuJSDs_uaxUdpvp7Ae4CTaro405Kjt8FcLNajbg3am9mC7UoV-Emi)

> [НЕО:](https://youtu.be/CsigSyTME9E?t=87) _Думаю, самый очевидный вопрос в том, как я могу тебе доверять?_

> ОРАКУЛ:_Это [тупик](/pickle-finance-rekt/), в этом нет никакого сомнения._

**Проблемы с доверием характерны для ценовых оракулов, и они могут быть как ончейновыми, так и офчейновыми.**

Как [написал](https://samczsun.com/so-you-want-to-use-a-price-oracle/) samczsun:

_Есть первый подход, в котором вы можете просто взять существующие офчейн данные на ценовых API или обменниках и перенести их в ончейн. В другом подходе вы можете мгновенно рассчитать цену, обратившись к децентрализованным ончейн обменникам._

Оба способа имеют свои достоинства и недостатки.

Офчейновые оракулы, **такие как Coinbase** обычно медленнее реагируют на волатильность, а также им требуются

**_«привилегированные пользователи, которые будут выкладывать данные в ончейн. Поэтому вы должны им доверять и надеяться, что они не переметнутся на сторону зла и что их не будут принуждать выкладывать неправильные обновления»_**

Сегодняшняя массовая ликвидация случилась из-за ошибки оракула Coinbase, или из-за того, что кто-то им манипулировал.

**Мы стали свидетелями ликвидации больше $100 миллионов по кредитам на платформе Compound Finance. Это случилось потому, что они зависели от Coinbase, их единственного оракула.**

![](https://lh6.googleusercontent.com/sR9XX4BQ3SiHSNM2iZzUh8msdZQ45UDfTkhhChTlKD55pzU3rNQU8hPyHUJndLeW7jXvbW0CWRErqePHbQQNnZ-KlR8HWbGNz2ImvumqAKO2sDaQozoq5pHTVyB7kmOhc6ZWj9P5)

Популярная в фарминге доходности пара DAI/USDC сорвалась с поводка, когда цена DAI подскочила до $1.3 и повлекла за собой массовые ликвидации и огромную прибыль для анонимных агентов, ждавших удобного момента, чтобы ликвидировать эти позиции.  

> [Sam Priestley](https://twitter.com/arbingsam/status/1331922588193484800?s=20) объясняет, почему может произойти ликвидация и как люди могут этим воспользоваться.
>
> «Сегодня на compound  кого-то ликвидировали на $49 миллионов. Ликвидатор получил $3.7 миллионов за то, что просто вызвал метод.

> Жертва была фермером comp, использовавшая левередж. Он(а) давал(а) в долг DAI и USDC и занимал(а) DAI и USDC. Когда цена DAI изменилась, счет подвергся ликвидации.  Если бы он(а) хранила(а) DAI и USCD в разных кошельках, этого бы не случилось.

> Когда ваш счет ликвидируют, ликвидатор может забрать себе любой из ваших залогов в обмен на уплату вашего долга.  Поэтому ликвидатор выбрал DAI. Займ DAI на Uniswap. Выплата долга DAI. Получение дополнительных DAI после ликвидации. Вернуть деньги на Uniswap. Прибыль.

> Кит наверное думал, что он в безопасности, потому что он никогда не вызывал функцию «enter-markets» на USDC. Но, взяв в долг USDC, он активировал USDC как залог в своем долге DAI."

![](https://lh4.googleusercontent.com/4s6zvtJuvM2gvebHTrXn_Nn5yf2wCtpMGMgQYkWmRFNgmyyT4vcfw1BpOKTNaZQkwMJ2dBo9ObVKOapaqOwykDqfT8f_Dx7dTBATRTD7egKq6y0il5mGetT2Jz6etsB97j0Cm4dC)

Спасибо [@arbingsam](https://twitter.com/arbingsam/status/1331922588193484800?s=20) за анализ.

На графике внизу виден скачок цены DAI - массивное колебание предположительно стабильной монеты.

![](https://lh4.googleusercontent.com/CWugWH8TcpdzKzgTzseevvzKjHuVzZGZ7XbUD1k6w5JT4v9Sqx2e0u4WsFoND5rFrb7cPehLXQhpNhwKNrtVOnlc7V51HSHaXMm0zvN9rELvuuTDzvFESAxTCo0SJPsQwnlt_K0k)

Когда на Coinbase [представили](https://blog.coinbase.com/introducing-the-coinbase-price-oracle-6d1ee22c7068)свой Оракул, они знали о проблемах, которые могут возникнуть при использовании офчейн-оракулов.

> _«Чтобы использовать данные с офчейн-источника, нужно доверять тому, кто публикует, и особенно в том, что он публикует правильные цены и хранит приватные ключи в безопасности»_

Однако, вместо того, чтобы уменьшить необходимость в доверии, они просто уверили читателя в том, что они достойны этого доверия.

> _Coinbase это одна из самых надежных компаний в криптосфере и наша миссия по больше части состоит в расширении криптоэкономии. К прочной инфраструктуре Coinbase привязан надежный источник ценовой информации. Это может обезопасить экосистему DeFi, уменьшить системные риски и запустить следующую волну роста и освоения._
>
> Похоже что Robert Leshner им поверил, потому как он тогда сказал;
>
> _«Ценовой оракул Coinbase усилит безопасность и децентрализацию источника ценовой информации Compound. Это ключевая миссия для протокола и экосистемы приложений, построенной на основе Compound._
>
> _— Robert Leshner, генеральный директор Compound_

![](https://raw.githubusercontent.com/RektHQ/Assets/main/images/2020/11/image.png)

**Так что же пошло не так?**

Если *в офчейновых оракулах нужно, чтобы привилегированные пользователи выкладывали данные в ончейн», *то как такое могло случиться?

На странице [статуса](https://status.coinbase.com/) Coinbase на данный момент отображает следующее:

![](https://lh6.googleusercontent.com/WQdMK6Voz-KX1DowA36GhZf8G3xrLN91xG6hFjHpevjVeA8VUL-2b3YPb-QYqyUBb9EjOoRG4c_M-gHNuoaMkmlze58fQUvpkim6SA-GtjkDt9KBh8gjFbMHwcjmk5QCZpt-LNVp)

У Оракула Coinbase уже бывали «неполадки» и раньше. А это, похоже, всегда ведет к крайне прибыльным ситуациям для некоторых игроков.   

Была ли это манипуляция или техническая неполадка, еще не ясно, но мы точно знаем, что флэш-кредиты не применялись. Такая манипуляция книгой заказов Coinbase якобы обошлась в 100.000 DAI, учитывая, что она была рассчитана на 300.000, а зафиксированное колебание цены достигло $1.3.

Случилось ли это по причине чьей-то злой воли, беспечности или устаревшей технологии?  В любом случае, ликвидационные боты поживились на этом инциденте. 

Использовать одиночный централизованный источник данных в качестве ценового оракула - неразумно. Coinbase показали себя с очень плохой стороны, особенно учитывая, что оказалось возможным стереть книгу заказов за 100К. 

> _"Здесь повсюду программы. Те, что делают свою работу, что от них и требовалось, незаметны. Ты бы даже никогда не узнал, что они здесь есть. Но есть и другие... о них постоянно говорят."_

![](https://lh6.googleusercontent.com/7H_rZ46PnRaGA2vlOfTOgp5Lz0wtz7M4nNyuqEnLDDEx8fd2U5j5kOsfyw7MOWSo406JcW5btz4BYFBKT6KwZeAZDsMZayIuWC_K_0HB4zfRwkP03AweiMCJkwT6TX7w3krY1Nfs)

И не переживай из-за вазы.
